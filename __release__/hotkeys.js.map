{"version":3,"file":"hotkeys.js","sources":["../undoManager/initialize.js","../macro__actions.js","../editor__tools.js"],"sourcesContent":["// @ts-nocheck\r\n\r\nvar redoLog = (() => { });\r\n// redoLog = redoLog || (() => { });\r\n\r\nvar editor = document.getElementById('editor') || document.querySelector('textarea'),\r\n\tundoStorage = [], \r\n\tredoStorage = [];\r\n\r\nexport default function main(target){\r\n\teditor = target;\r\n}\r\n\r\neditor.addEventListener('keydown', function (event) {\r\n\t\r\n\t// console.log(event)\r\n\t\r\n\tinput.selection = {\r\n\t\tstart: event.target.selectionStart,\r\n\t\tend: event.target.selectionEnd,\r\n\t};\r\n\r\n\tif (input.selection_length) input.lostData = editor.value.slice(\r\n\t\tinput.selection.start,\r\n\t\tinput.selection.end\r\n\t)\r\n\telse input.lostData = editor.value.slice(\r\n\t\tinput.selection.start - 1,\r\n\t\tinput.selection.end + 1\r\n\t)\r\n\r\n});\r\neditor.addEventListener('paste', e => {\r\n\r\n\tinput.data = (window.clipboardData || e.clipboardData).getData('text/plain');\r\n\tinput.data = input.data.replace(/\\r\\n/g, '\\n');\r\n\t// если вызвано из контекстного меню, то выделение надо ловить в контекстном меню\r\n\r\n});\r\neditor.addEventListener('input', event => {\t\t\t// event.inputType && event.data\t\r\n\r\n\tconsole.log(event)\r\n\r\n\tif (event.inputType == 'historyUndo') {\r\n\t\tconsole.log(event.inputType);\r\n\t\tevent.preventDefault();\t\t\t\t\t\t// prevent need on keypress\t\t\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tinput.type = event.inputType;\r\n\tif (input.type !== InputActionType.insertFromPaste) input.data = event.data;\r\n\r\n\tif (!input.selection_length) {\r\n\t\tif (input.type == InputActionType.deleteContentBackward) {\r\n\t\t\tinput.selection.start--;\r\n\t\t\tinput.selection.end--;\r\n\t\t\tinput.lostData = input.lostData[0];\r\n\t\t}\r\n\t\telse if (input.type == InputActionType.deleteContentForward) input.lostData = input.lostData[1];\r\n\t\telse if (input.type == InputActionType.insertText || input.type == InputActionType.insertFromPaste) {\r\n\r\n\t\t\tinput.lostData = input.lostData.slice(1, -1);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t\r\n\t\t// input.lostData = input.lostData.slice(1, -1); // !\r\n\t\tinput.selection.end = input.selection.start + ((input.selection.data || {}).length || 0);\r\n\r\n\t}\r\n\r\n\t// action apply\r\n\t// InputTypeAction[event.inputType](event);\r\n\tundoStorage.push(Object.assign({}, input)); //  undoStorage.push(JSON.parse(JSON.stringify(input)))\r\n\r\n\t// clear redo action storage\r\n\tif (event.inputType != 'historyUndo') {\r\n\r\n\t\tredoStorage.splice(0, redoStorage.length);\r\n\t\tredoLog();\r\n\t}\r\n\telse redoLog(undoStorage);\r\n});\r\n\r\n\r\nconst input = {\r\n\r\n\ttype: null,\t\t// 'insertFromPaste' | 'deleteByCut' | 'insertText' | 'deleteContentBackward' | ...\r\n\tdata: null,\t\t//  inserted char by 'insertText' type\r\n\tlostData: null, //  data been selected on insert\r\n\r\n\tget selection_length() { return this.selection.end - this.selection.start },\r\n\tselection: {\r\n\t\tstart: null,\r\n\t\tend: null\r\n\t},\r\n}\r\n\r\n\r\n\r\nfunction actionApply(doingState, doingType) {\r\n\r\n\tif (Boolean(doingType) !== Boolean('redo')) var lostData = doingState.lostData, data = doingState.data;\r\n\telse { \r\n\t\tvar data = doingState.lostData, \r\n\t\t\tlostData = doingState.data; \r\n\t}\r\n\r\n\tswitch (doingState.type) {\r\n\t\tcase 'insertFromPaste':\t\t\t\r\n\r\n\t\t\teditor.value = (\r\n\t\t\t\teditor.value.substring(0, doingState.selection.start) + lostData +\r\n\t\t\t\teditor.value.substring(doingState.selection.start + data.length)\r\n\t\t\t);\r\n\t\t\teditor.setSelectionRange(doingState.selection.start, doingState.selection.end + lostData.length);\r\n\t\t\tif (doingState.caret) editor.selectionStart = editor.selectionEnd;\r\n\r\n\t\t\tbreak;\r\n\t\tcase 'insertText':\r\n\r\n\t\t\tif (!doingState.selection_length)\r\n\t\t\t\teditor.value = (\r\n\t\t\t\t\teditor.value.substring(0, doingState.selection.start) + (lostData || '') +\r\n\t\t\t\t\teditor.value.substring(doingState.selection.start + (data || '').length)  //  + !doingType\r\n\t\t\t\t);\r\n\r\n\t\t\teditor.setSelectionRange(\r\n\t\t\t\tdoingState.selection.start + lostData.length, \r\n\t\t\t\tdoingState.selection.end + lostData.length\t\t  // + lostData.length * !!doingType\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\t\tcase 'deleteByCut': // either cut approach\r\n\t\tcase 'deleteContentForward': // del on sel.len == 0\r\n\t\tcase 'deleteContentBackward': // all other approaches to del\r\n\t\t\teditor.value = (\r\n\t\t\t\teditor.value.substring(0, doingState.selection.start) + (lostData || '') +\r\n\t\t\t\teditor.value.substring(doingState.selection.end + !!doingType*(data || '').length)\r\n\t\t\t);\r\n\r\n\t\t\teditor.selectionStart = editor.selectionEnd = (\r\n\t\t\t\tdoingState.selection.start +\r\n\t\t\t\t(\r\n\t\t\t\t\tdoingState.type == InputActionType.deleteContentBackward && (lostData || '').length == 1\r\n\t\t\t\t)\r\n\t\t\t);\r\n\r\n\t\t\tif ((lostData || '').length > 1) editor.selectionEnd = doingState.selection.start + lostData.length;\r\n\t\t\t\r\n\t\t\tbreak;\r\n\t}\t\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport const storeMultiactions = function(event, callback, onfinish){\r\n\r\n\tevent.target.dispatchEvent(new KeyboardEvent('keydown'));\r\n\r\n\tlet opts = callback(event);\t\t \t\t\t\t\t\t\t// multiActions[event.key](event);\r\n\r\n\tlet transfer = new DataTransfer();\t\t\t\t\t\t\t// так для IE не будет работать\r\n\ttransfer.setData('text/plain', \r\n\t\tevent.target.value.slice(event.target.selectionStart, event.target.selectionEnd  // or line.slice(1)\r\n\t));\r\n\tlet clipboardEvent = new ClipboardEvent('paste', {\r\n\t\tclipboardData: transfer\r\n\t})\r\n\r\n\tevent.target.dispatchEvent(clipboardEvent);\r\n\tevent.target.dispatchEvent(new InputEvent('input',{\t\t\t// так для IE не будет работать \r\n\t\tdata: null,\r\n\t\tinputType: 'insertFromPaste'\r\n\t}));\t\r\n\tif (onfinish) onfinish(opts);\r\n}\r\nexport const storeAction = function(event, callback, kwargs){\r\n\tevent.target.selectionStart = kwargs.startLine + 1;\r\n\tevent.target.selectionEnd = kwargs.endLine;\r\n\tevent.target.dispatchEvent(new KeyboardEvent('keydown', {}));\t\t\r\n\r\n\tlet preformat = callback(event);\r\n\r\n\tlet transfer = new DataTransfer(); \t\t\t\t\t// так для IE не будет работать\r\n\ttransfer.setData('text/plain', event.target.value.substr(kwargs.startLine + 1, preformat.line.length));\r\n\tlet clipboardEvent = new ClipboardEvent('paste', { clipboardData: transfer })\r\n\r\n\tevent.target.dispatchEvent(clipboardEvent);\r\n\tinput.caret = 123;\r\n\tevent.target.dispatchEvent(new InputEvent('input',{\t// так для IE не будет работать \r\n\t\tdata: null,\r\n\t\tinputType: 'insertFromPaste'\r\n\t}));\t\r\n\tinput.caret = undefined;\r\n\t\r\n\treturn preformat;\r\n}\r\n\r\n\r\nconst InputActionType =\r\n{\r\n\tinsertFromPaste: 'insertFromPaste',\t\t\t\t\t// get selection (keydown) and clipboardData (paste)\r\n\tdeleteByCut: 'deleteByCut',\t\t\t\t\t\t\t// get selection (keydown) \r\n\tinsertText: 'insertText',\t\t\t\t\t\t\t// get data (input) and selection (keydown)\r\n\tdeleteContentBackward: 'deleteContentBackward',\t\t// get selection (keydown)\r\n\tdeleteContentForward: 'deleteContentForward'\t\t// get selection (keydown)\r\n}\r\n\r\n\r\nconst redo = (e) => {\r\n\tlet redoState = redoStorage.pop();\r\n\tif (redoState) {\r\n\t\tundoStorage.push(redoState), redoLog();\r\n\t\t\r\n\t\tactionApply(redoState, 'redo');\r\n\t\te.preventDefault();\r\n\t}\r\n\t\r\n}\r\nexport const undo = (e) => {\r\n\tif (e.shiftKey) return redo(e);\r\n\r\n\tlet undoState = undoStorage.pop();\r\n\tif (undoState) {\r\n\t\tredoStorage.push(undoState), redoLog();\r\n\r\n\t\tactionApply(undoState, '');\r\n\t\te.preventDefault();\r\n\t}\r\n}","// @ts-nocheck\r\nexport var actionsMacro = {\r\n\r\n\ttag_in (value, line) { \r\n\t\tlet res = this.begin_end(['<'+value+'>', '</'+value+'>'], line); \r\n\t\tres.offset += res.offset + 1;\r\n\t\treturn res;\r\n\t},\r\n\r\n\t\r\n\tbegin_end:  (value, line) => {\r\n\r\n\t\tlet start = value[0],\r\n\t\t\tend = value[1];\t\t\r\n\t\tconst regex = new RegExp(start + '([\\\\s\\\\S]*?)' + end);\r\n\t\tconst undoFlag = line.match(regex);\r\n\r\n\t\treturn {\r\n\t\t\tline: undoFlag ? line.replace(regex, '$1') : start + line + end,\r\n\t\t\toffset: start.length,\r\n\t\t\tundo: undoFlag\r\n\t\t}\t\t\r\n\t},\r\n\tbegin: (value, line, event) => {\r\n\t\t// let value = '# '\r\n\t\t// const undoFlag = new RegExp('^' + value + '[\\\\s\\\\S]+?$').exec(line);\r\n\t\t// const undoFlag= line.match(/^# [\\S\\s]+?$/);\t// regex.exec(line);\r\n\t\t// const regex = new RegExp('^' + value + '([\\\\s\\\\S]+?)$').compile(); # err\r\n\r\n\t\tconst regex = new RegExp('^' + value + '([\\\\s\\\\S]+?)$');\r\n\t\tlet undoFlag = !event ? regex.exec(line) : event.shiftKey;\t\t\r\n\t\treturn {\r\n\t\t\t// line: undoFlag ? line.replace(/# ([\\s\\S]*?)/, '$1') : value + line,\r\n\t\t\tline: undoFlag ? line.replace(regex, '$1') : value + line,\r\n\t\t\toffset: value.length,\r\n\t\t\tundo: undoFlag,\r\n\t\t\teventAbort: true\r\n\t\t}\r\n\t},\t\t\t\r\n\t// get(){console.log(this)},\r\n}\r\n\r\n\r\nexport var multiMacro = {\r\n\r\n\r\n\tbegin: (value, e, target) => {\r\n\r\n\t\tlet start = target.selectionStart,\r\n\t\t\tend = target.selectionEnd;\r\n\r\n\t\tlet line = target.value.substring(start - 1, end);\r\n\t\tlet len = (line.split('\\n').length - 1) * value.length,\r\n\t\t\tundo = line.startsWith('\\n' + value);\r\n\r\n\t\tif (len === 0) format_text(e);\t\t\t\r\n\t\telse {\r\n\t\r\n\t\t\tlet startLine = target.value.substring(0, start - 1);\r\n\t\t\tline = !undo\r\n\t\t\t\t? line.replace(new RegExp('\\n', 'g'), '\\n' + value)\r\n\t\t\t\t: line.replace(new RegExp('\\n' + value, 'g'), '\\n');\r\n\t\r\n\t\t\ttarget.value = [startLine, line, target.value.substring(end)].join('');\r\n\t\r\n\t\t\t// target.setSelectionRange(start, end + len * (e.shiftKey ? -1 : 1));\r\n\t\t\ttarget.selectionStart = start;\r\n\t\t\ttarget.selectionEnd = end + len * (undo ? -1 : 1);\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t},\r\n\tbegin_end: (value, e, target) => {\r\n\r\n\t\tlet start = target.selectionStart,\r\n\t\t\tend = target.selectionEnd;\r\n\t\tlet line = target.value.substring(start, end);\r\n\r\n\t\tif (line.split('\\n').length === 1) format_text(e); \t\t\t\t\t\t\t// todo ?\r\n\t\telse {\r\n\t\r\n\t\t\tlet startText = target.value.substring(0, start);\r\n\t\t\tline = value[0] + target.value.substring(start, end) + value[1];\r\n\t\t\tlet endText = target.value.substring(end);\r\n\t\t\ttarget.value = [startText, line, endText].join('');\r\n\t\r\n\t\t\ttarget.setSelectionRange(start, end + value[0].length + value[1].length);\r\n\t\t\t// target.selectionStart = start + value[0].length;\r\n\t\t\t// target.selectionStart = target.selectionEnd = end + value[0].length + value[1].length;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\treturn { backoffset: value[1].length }\r\n\t}\t\r\n\r\n\r\n}","// @ts-nocheck\r\n\r\nimport { storeMultiactions, storeAction, undo } from \"./undoManager/initialize\";\r\nimport main from './undoManager/initialize';\r\nimport { actionsMacro, multiMacro } from \"./macro__actions\";\r\n\r\nvar editor = null,\r\n\tmultiActions = {},\r\n\tactions = {};\r\n\r\nexport default function initialize(target, keys, panel) {\r\n\r\n\tmain(editor = target || document.querySelector('textarea'));\r\n\tif (!(target instanceof HTMLTextAreaElement)) throw new Error('editor with hot keys needs textarea on the page');\r\n\r\n\teditor.addEventListener('keydown', preformat);\r\n\tif (keys instanceof Object){\r\n\r\n\t\tif ('actions' in keys && keys.actions instanceof Object) \r\n\t\t{\r\n\t\t\tactions = keys.actions;\r\n\t\t\t// actions.__proto__ = actionsMacro;\r\n\t\t}\r\n\t\tif ('multiActions' in keys && keys.multiActions instanceof Object) {\r\n\r\n\t\t\tmultiActions = keys.multiActions;\t\t\r\n\t\t\t// multiActions.__proto__ = multiMacro;\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tif (panel instanceof HTMLElement) panel = [].slice.apply(panel.querySelectorAll(`.${panel.className}>*`));\r\n\tif (Array.isArray(panel)) {\r\n\t\tpanel.forEach(btn => btn.addEventListener('onclick', format_text));\r\n\t}\r\n}\r\n\r\ninitialize.actionsMacro = actionsMacro;\r\ninitialize.multiMacro = multiMacro;\r\n\r\n/**\r\n * в отличие от format_text(e)  \r\n * - триггерится только на текстареа (через нажатие горячих клавиш)\r\n * - обрабатывает случаи для таб\r\n * @param {*} event \r\n */\r\nfunction preformat(event) {\r\n\t\r\n\t// console.log(event);\r\n\tif (event.ctrlKey) event.code != 'KeyZ' ? format_text(event) : undo(event);\r\n\telse if (event.key.toLowerCase() === 'tab') {\r\n\r\n\t\t// определим, выделен ли текст\r\n\t\tlet start = event.target.selectionStart;\r\n\t\tlet end = event.target.selectionEnd;\r\n\t\tif (end - start > 0) {\r\n\r\n\t\t\tlet line = event.target.value.substring(start - 1, end);\r\n\t\t\tlet len = line.split('\\n').length - 1;\r\n\t\t\tif (len === 0) format_text(event);\r\n\t\t\telse {\r\n\t\t\t\t\r\n\t\t\t\tstoreMultiactions(event, () => {\r\n\r\n\t\t\t\t\tlet startLine = event.target.value.substring(0, start - 1)\r\n\t\t\t\t\tline = !event.shiftKey ? line.replace(/\\n/g, '\\n\t') : line.replace(/\\n\t/g, '\\n');\r\n\t\t\t\t\tlet endLine = event.target.value.substring(end);\r\n\t\t\t\t\tevent.target.value = [startLine, line, endLine].join('');\r\n\t\r\n\t\t\t\t\tevent.target.selectionStart = start;\r\n\t\t\t\t\tevent.target.selectionEnd = end + len * (event.shiftKey ? -1 : 1);\r\n\r\n\t\t\t\t})\r\n\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t\telse format_text(event);\r\n\t}\r\n}\r\n\r\n/**\r\n * форматирует выделенный фрагмент или строку, в которой находится каретка в текущий момент, \r\n * в соответствии с заданными правилами (actions и multiActions соответственно)\r\n * @param {*} event \r\n * @param {*} fake - эмуляция нажатого символа (опционально) для событий, не передающих нажатие клавиш (e.key)\r\n */\r\nfunction format_text(event, fake) {\t\r\n\r\n\tlet caret = null || 0;\r\n\tfake = fake || event.target.getAttribute('data-key')\r\n\r\n\t// получаем позицию курсора\r\n\tif (editor.selectionStart !== undefined) {\r\n\t\tif (editor.selectionStart < editor.selectionEnd) {\r\n\t\t\tif (editor.value.slice(editor.selectionStart, editor.selectionEnd).split('\\n').length > 1) {\r\n\t\t\t\tevent.key = event.key || event.target.getAttribute('data-key');\r\n\t\t\t\tif (multiActions[event.key]) {\r\n\t\r\n\t\t\t\t\tevent.target.dispatchEvent(new KeyboardEvent('keydown'));\r\n\t\r\n\t\t\t\t\tstoreMultiactions(\r\n\t\t\t\t\t\tevent, \r\n\t\t\t\t\t\t() => multiActions[event.key](event),\r\n\t\t\t\t\t\t// opts => editor.selectionStart = editor.selectionEnd = editor.selectionEnd - opts.backoffset\r\n\t\t\t\t\t);\r\n\t\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t// if(middlelineActions[event.key](event)) return; - // todo\t\t\t\t\r\n\t\t\t\t// замена посреди строки (для ссылок и курсивного текста, например)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcaret = editor.selectionStart;\r\n\t}\r\n\telse alert('The browser not supports hot keys');\t\t\t\t// polyfill is required\r\n\r\n\r\n\t// получаем позицию начала строки\r\n\tlet startLine = (editor.value.lastIndexOf('\\n', caret - 1));\r\n\tif (startLine < 0) startLine = 0;\r\n\r\n\r\n\t// получаем позицию конца строки\r\n\tlet endLine = (editor.value.indexOf('\\n', caret));\r\n\tif (endLine < 0) endLine = editor.value.length;\r\n\r\n\r\n\t// получаем текст:\r\n\tlet preLine = editor.value.substr(0, startLine ? startLine + 1 : startLine);\r\n\tlet line = editor.value.substring(startLine ? startLine + 1 : startLine, endLine);\r\n\tlet postLine = editor.value.substr(endLine);\r\n\r\n\t// actions.get(event && (event.key || (event.target.tagName.toLowerCase() === 'button' ? '/' : undefined)))\r\n\r\n\r\n\t// !todo undoMaager binding:\r\n\tvar formatAction = actions[event && (event.key || fake)];\t\t\r\n\tif (!event.key) event = {target: editor};\t\t\t\t\t\t // для кнопки нужно подменить target\r\n\tif (formatAction) {\r\n\r\n\t\tlet preformat = storeAction(event, () => {\r\n\t\t\tvar preformat = formatAction(line, event);\t\t\t\r\n\t\t\teditor.value = preLine + preformat.line + postLine;\r\n\t\t\treturn preformat; },{\r\n\t\t\tstartLine: startLine, endLine: endLine\r\n\t\t})\r\n\r\n\t\tif (preformat.eventAbort) event.preventDefault();\r\n\t\t// возвращаем выделение\r\n\t\teditor.selectionStart = editor.selectionEnd = caret + preformat.offset * (preformat.undo ? -1 : 1);\t\t\t\t\r\n\t\t\r\n\t}\r\n\telse {\r\n\t\treturn;\r\n\t}\r\n\r\n\teditor.focus();\r\n\r\n}"],"names":["editor","document","getElementById","querySelector","undoStorage","redoStorage","addEventListener","event","input","selection","start","target","selectionStart","end","selectionEnd","selection_length","lostData","value","slice","e","data","window","clipboardData","getData","replace","console","log","inputType","preventDefault","type","InputActionType","insertFromPaste","length","deleteContentBackward","deleteContentForward","insertText","push","Object","assign","splice","this","actionApply","doingState","doingType","Boolean","substring","setSelectionRange","caret","storeMultiactions","callback","onfinish","dispatchEvent","KeyboardEvent","opts","transfer","DataTransfer","setData","clipboardEvent","ClipboardEvent","InputEvent","storeAction","kwargs","startLine","endLine","preformat","substr","line","undefined","deleteByCut","undo","shiftKey","redoState","pop","undoState","multiMacro","begin","len","split","startsWith","format_text","RegExp","join","begin_end","startText","endText","backoffset","multiActions","actions","initialize","keys","panel","HTMLTextAreaElement","Error","HTMLElement","apply","querySelectorAll","className","Array","isArray","forEach","btn","ctrlKey","code","key","toLowerCase","fake","getAttribute","alert","lastIndexOf","indexOf","preLine","postLine","formatAction","eventAbort","offset","focus","actionsMacro","tag_in","res","regex","undoFlag","match","exec"],"mappings":"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"}