{"version":3,"file":"hotkeys.js","sources":["../undoManager/initialize.js","../macro__actions.js","../editor__tools.js"],"sourcesContent":["// @ts-nocheck\r\n\r\nvar redoLog = (() => { });\r\n// redoLog = redoLog || (() => { });\r\n\r\nvar editor = document.getElementById('editor') || document.querySelector('textarea'),\r\n\tundoStorage = [],\r\n\tredoStorage = [];\r\n\r\nexport default function main(target) {\r\n\teditor = target;\r\n}\r\n\r\neditor.addEventListener('keydown', function (event) {\r\n\r\n\t// console.log(event)\r\n\r\n\tinput.selection = {\r\n\t\tstart: event.target.selectionStart,\r\n\t\tend: event.target.selectionEnd,\r\n\t};\r\n\r\n\tif (input.selection_length) {\r\n\t\tinput.lostData = editor.value.slice(\r\n\t\t\tinput.selection.start,\r\n\t\t\tinput.selection.end\r\n\t\t)\r\n\t}\r\n\telse {\r\n\t\tinput.lostData = editor.value.slice(\r\n\t\t\tinput.selection.start - 1,\r\n\t\t\tinput.selection.end + 1\r\n\t\t)\r\n\t}\r\n\r\n});\r\neditor.addEventListener('paste', e => {\r\n\r\n\tinput.data = (window.clipboardData || e.clipboardData).getData('text/plain');\r\n\tinput.data = input.data.replace(/\\r\\n/g, '\\n');\r\n\t// если вызвано из контекстного меню, то выделение надо ловить в контекстном меню\r\n\r\n});\r\neditor.addEventListener('input', event => {\t\t\t// event.inputType && event.data\t\r\n\r\n\tconsole.log(event)\r\n\r\n\tif (event.inputType == 'historyUndo') {\r\n\t\tconsole.log(event.inputType);\r\n\t\tevent.preventDefault();\t\t\t\t\t\t// prevent need on keypress\t\t\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tinput.type = event.inputType;\r\n\tif (input.type !== InputActionType.insertFromPaste) input.data = event.data;\r\n\r\n\tif (!input.selection_length) {\r\n\t\tif (input.type == InputActionType.deleteContentBackward) {\r\n\t\t\tinput.selection.start--;\r\n\t\t\tinput.selection.end--;\r\n\t\t\tinput.lostData = input.lostData[0];\r\n\t\t}\r\n\t\telse if (input.type == InputActionType.deleteContentForward) input.lostData = input.lostData[1];\r\n\t\telse if (input.type == InputActionType.insertText || input.type == InputActionType.insertFromPaste) {\r\n\r\n\t\t\tinput.lostData = input.lostData.slice(1, -1);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\r\n\t\t// input.lostData = input.lostData.slice(1, -1); // !\r\n\t\tinput.selection.end = input.selection.start; // + ((input.data || {}).length || 0);\t\t\r\n\r\n\t}\r\n\r\n\t// action apply\r\n\t// InputTypeAction[event.inputType](event);\r\n\tundoStorage.push(Object.assign({}, input)); //  undoStorage.push(JSON.parse(JSON.stringify(input)))\r\n\r\n\t// clear redo action storage\r\n\tif (event.inputType != 'historyUndo') {\r\n\r\n\t\tredoStorage.splice(0, redoStorage.length);\r\n\t\tredoLog();\r\n\t}\r\n\telse redoLog(undoStorage);\r\n});\r\n\r\n\r\nexport const input = {\r\n\r\n\ttype: null,\t\t// 'insertFromPaste' | 'deleteByCut' | 'insertText' | 'deleteContentBackward' | ...\r\n\tdata: null,\t\t//  inserted char by 'insertText' type\r\n\tlostData: null, //  data been selected on insert\r\n\r\n\tget selection_length() { return this.selection.end - this.selection.start },\r\n\tselection: {\r\n\t\tstart: null,\r\n\t\tend: null\r\n\t},\r\n}\r\n\r\n\r\n\r\nfunction actionApply(doingState, doingType) {\r\n\r\n\tif (Boolean(doingType) !== Boolean('redo')) var lostData = doingState.lostData, data = doingState.data;\r\n\telse {\r\n\t\tvar data = doingState.lostData,\r\n\t\t\tlostData = doingState.data;\r\n\t}\r\n\r\n\tswitch (doingState.type) {\r\n\t\tcase 'insertFromPaste':\r\n\r\n\t\t\teditor.value = (\r\n\t\t\t\teditor.value.substring(0, doingState.selection.start) + lostData +\r\n\t\t\t\teditor.value.substring(doingState.selection.start + data.length)\r\n\t\t\t);\r\n\t\t\teditor.setSelectionRange(doingState.selection.start, doingState.selection.end + lostData.length);\r\n\t\t\tif (doingState.caret) editor.selectionStart = editor.selectionEnd;\r\n\r\n\t\t\tbreak;\r\n\t\tcase 'insertText':\r\n\r\n\t\t\tif (!doingState.selection_length)\r\n\t\t\t\teditor.value = (\r\n\t\t\t\t\teditor.value.substring(0, doingState.selection.start) + (lostData || '') +\r\n\t\t\t\t\teditor.value.substring(doingState.selection.start + (data || '').length)  //  + !doingType\r\n\t\t\t\t);\r\n\r\n\t\t\teditor.setSelectionRange(\r\n\t\t\t\tdoingState.selection.start + lostData.length,\r\n\t\t\t\tdoingState.selection.end + lostData.length\t\t  // + lostData.length * !!doingType\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\t\tcase 'deleteByCut': // either cut approach\r\n\t\tcase 'deleteContentForward': // del on sel.len == 0\r\n\t\tcase 'deleteContentBackward': // all other approaches to del\r\n\t\t\teditor.value = (\r\n\t\t\t\teditor.value.substring(0, doingState.selection.start) + (lostData || '') +\r\n\t\t\t\teditor.value.substring(doingState.selection.end + !!doingType * (data || '').length)\r\n\t\t\t);\r\n\r\n\t\t\teditor.selectionStart = editor.selectionEnd = (\r\n\t\t\t\tdoingState.selection.start +\r\n\t\t\t\t(\r\n\t\t\t\t\tdoingState.type == InputActionType.deleteContentBackward && (lostData || '').length == 1\r\n\t\t\t\t)\r\n\t\t\t);\r\n\r\n\t\t\tif ((lostData || '').length > 1) editor.selectionEnd = doingState.selection.start + lostData.length;\r\n\r\n\t\t\tbreak;\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport const storeMultiactions = function (event, callback, onfinish) {\r\n\r\n\tevent.target.dispatchEvent(new KeyboardEvent('keydown'));\r\n\r\n\tlet postOptions = callback(event);\t\t \t\t\t\t\t\t\t// multiActions[event.key](event);\r\n\r\n\tlet transfer = new DataTransfer();\t\t\t\t\t\t\t// так для IE не будет работать\r\n\ttransfer.setData('text/plain',\r\n\t\tevent.target.value.slice(event.target.selectionStart, event.target.selectionEnd  // or line.slice(1)\r\n\t));\r\n\tlet clipboardEvent = new ClipboardEvent('paste', { clipboardData: transfer })\r\n\r\n\tevent.target.dispatchEvent(clipboardEvent);\r\n\tevent.target.dispatchEvent(new InputEvent('input', {\t\t\t// так для IE не будет работать \r\n\t\tdata: null,\r\n\t\tinputType: 'insertFromPaste'\r\n\t}));\r\n\tif (onfinish && postOptions && postOptions.backoffset !== undefined) onfinish(postOptions);\r\n}\r\nexport const storeAction = function (event, callback, kwargs) {\r\n\tevent.target.selectionStart = kwargs.startLine + 1;\r\n\tevent.target.selectionEnd = kwargs.endLine;\r\n\tevent.target.dispatchEvent(new KeyboardEvent('keydown', {}));\r\n\r\n\tlet preformat = callback(event);\r\n\r\n\tlet transfer = new DataTransfer(); \t\t\t\t\t// так для IE не будет работать\r\n\ttransfer.setData('text/plain', event.target.value.substr(kwargs.startLine + 1, preformat.line.length));\r\n\tlet clipboardEvent = new ClipboardEvent('paste', { clipboardData: transfer })\r\n\r\n\tevent.target.dispatchEvent(clipboardEvent);\r\n\tinput.caret = 123;\r\n\tevent.target.dispatchEvent(new InputEvent('input', {\t// так для IE не будет работать \r\n\t\tdata: null,\r\n\t\tinputType: 'insertFromPaste'\r\n\t}));\r\n\tinput.caret = undefined;\r\n\r\n\treturn preformat;\r\n}\r\n\r\n\r\nconst InputActionType =\r\n{\r\n\tinsertFromPaste: 'insertFromPaste',\t\t\t\t\t// get selection (keydown) and clipboardData (paste)\r\n\tdeleteByCut: 'deleteByCut',\t\t\t\t\t\t\t// get selection (keydown) \r\n\tinsertText: 'insertText',\t\t\t\t\t\t\t// get data (input) and selection (keydown)\r\n\tdeleteContentBackward: 'deleteContentBackward',\t\t// get selection (keydown)\r\n\tdeleteContentForward: 'deleteContentForward'\t\t// get selection (keydown)\r\n}\r\n\r\n\r\nconst redo = (e) => {\r\n\tlet redoState = redoStorage.pop();\r\n\tif (redoState) {\r\n\t\tundoStorage.push(redoState), redoLog();\r\n\r\n\t\tactionApply(redoState, 'redo');\r\n\t\te.preventDefault();\r\n\t}\r\n\r\n}\r\nexport const undo = (e) => {\r\n\tif (e.shiftKey) return redo(e);\r\n\r\n\tlet undoState = undoStorage.pop();\r\n\tif (undoState) {\r\n\t\tredoStorage.push(undoState), redoLog();\r\n\r\n\t\tactionApply(undoState, '');\r\n\t\te.preventDefault();\r\n\t}\r\n}","// @ts-nocheck\r\n\r\n// import { input } from \"./undoManager/initialize\";\r\n\r\nexport const buffer = { paste: null };\r\nexport const finalPosition = Object.freeze({\r\n\tBegin: 0,\r\n\tpreBegin: 1,\r\n\tfillInside: 2,\r\n\tFill: 3,\r\n\tpreEnd: 4,\r\n\tEnd: 5,\t\r\n})\r\n\r\nexport var actionsMacro = {\r\n\r\n\ttag_in (value, line) { \r\n\t\tlet res = this.begin_end(['<'+value+'>', '</'+value+'>'], line); \r\n\t\tres.offset += res.offset + 1;\r\n\t\treturn res;\r\n\t},\r\n\r\n\t\r\n\tbegin_end:  (value, line) => {\r\n\r\n\t\tlet start = value[0],\r\n\t\t\tend = value[1];\t\t\r\n\t\tconst regex = new RegExp(start + '([\\\\s\\\\S]*?)' + end);\r\n\t\tconst undoFlag = line.match(regex);\r\n\r\n\t\treturn {\r\n\t\t\tline: undoFlag ? line.replace(regex, '$1') : start + line + end,\r\n\t\t\toffset: start.length,\r\n\t\t\tundo: undoFlag\r\n\t\t}\t\t\r\n\t},\r\n\tbegin: (value, line, event) => {\r\n\t\t// let value = '# '\r\n\t\t// const undoFlag = new RegExp('^' + value + '[\\\\s\\\\S]+?$').exec(line);\r\n\t\t// const undoFlag= line.match(/^# [\\S\\s]+?$/);\t// regex.exec(line);\r\n\t\t// const regex = new RegExp('^' + value + '([\\\\s\\\\S]+?)$').compile(); # err\r\n\r\n\t\tconst regex = new RegExp('^' + value + '([\\\\s\\\\S]+?)$');\r\n\t\tlet undoFlag = !event ? regex.exec(line) : event.shiftKey;\t\t\r\n\t\treturn {\r\n\t\t\t// line: undoFlag ? line.replace(/# ([\\s\\S]*?)/, '$1') : value + line,\r\n\t\t\tline: undoFlag ? line.replace(regex, '$1') : value + line,\r\n\t\t\toffset: value.length,\r\n\t\t\tundo: undoFlag,\r\n\t\t\teventAbort: true\r\n\t\t}\r\n\t},\t\t\t\r\n\t// get(){console.log(this)},\r\n}\r\n\r\n\r\nexport var multiMacro = {\r\n\r\n\r\n\tbegin: (value, e, target) => {\r\n\r\n\t\tlet start = target.selectionStart,\r\n\t\t\tend = target.selectionEnd;\r\n\r\n\t\tlet line = target.value.substring(start - 1, end);\r\n\t\tlet len = (line.split('\\n').length - 1) * value.length,\r\n\t\t\tundo = line.startsWith('\\n' + value);\r\n\r\n\t\t// @ts-ignore\r\n\t\tif (len === 0) format_text(e);\t\t\t\r\n\t\telse {\r\n\t\r\n\t\t\tlet startLine = target.value.substring(0, start - 1);\r\n\t\t\tline = !undo\r\n\t\t\t\t? line.replace(new RegExp('\\n', 'g'), '\\n' + value)\r\n\t\t\t\t: line.replace(new RegExp('\\n' + value, 'g'), '\\n');\r\n\t\r\n\t\t\ttarget.value = [startLine, line, target.value.substring(end)].join('');\r\n\t\r\n\t\t\t// target.setSelectionRange(start, end + len * (e.shiftKey ? -1 : 1));\r\n\t\t\ttarget.selectionStart = start;\r\n\t\t\ttarget.selectionEnd = end + len * (undo ? -1 : 1);\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t},\r\n\tbegin_end: (value, e, target) => {\r\n\r\n\t\tlet start = target.selectionStart,\r\n\t\t\tend = target.selectionEnd;\r\n\t\tlet line = target.value.substring(start, end);\r\n\r\n\t\t// @ts-ignore\r\n\t\tif (line.split('\\n').length === 1) format_text(e); \t\t\t\t\t\t\t// todo ?\r\n\t\telse {\r\n\t\r\n\t\t\tlet startText = target.value.substring(0, start);\r\n\t\t\tline = value[0] + target.value.substring(start, end) + value[1];\r\n\t\t\tlet endText = target.value.substring(end);\r\n\t\t\ttarget.value = [startText, line, endText].join('');\r\n\t\r\n\t\t\ttarget.setSelectionRange(start, end + value[0].length + value[1].length);\r\n\t\t\t// target.selectionStart = start + value[0].length;\r\n\t\t\t// target.selectionStart = target.selectionEnd = end + value[0].length + value[1].length;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\treturn { backoffset: undefined } // value[1].length\r\n\t},\r\n\tpaste_inline: (value, e, target, position, condition) => {\r\n\r\n\t\tlet start = target.selectionStart, end = target.selectionEnd;\r\n\t\tlet line = target.value.substring(start, end);\t\t\r\n\t\t\r\n\t\tif (line.indexOf('\\n') > 0) return;\r\n\t\telse{\r\n\t\t\tbuffer.paste = (event, _buff) => { if (!condition(_buff)) return;\r\n\t\t\t\t\r\n\t\t\t\tlet startText = target.value.substring(0, start);\r\n\t\t\t\tline = value.replace('%1', line).replace('$1', _buff)\t\t\t\t\r\n\t\t\t\tlet endText = target.value.substring(end);\r\n\t\t\t\ttarget.value = [startText, line, endText].join('');\t\r\n\t\t\t\ttarget.selectionEnd = (target.selectionStart = start) + line.length;\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tbuffer.paste = null;\r\n\r\n\t\t\t\tlet transfer = new DataTransfer(); \t\t\t    \t\t// так для IE не будет работать\r\n\t\t\t\ttransfer.setData('text/plain', line);\t\t\t\t\r\n\t\t\t\tevent.target.dispatchEvent(new ClipboardEvent('paste', { clipboardData: transfer }));\t\t\t\t\r\n\t\t\t\ttarget.dispatchEvent(new InputEvent('input', {\t\t\t// так для IE не будет работать \r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\tinputType: 'insertFromPaste'\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tif (position === finalPosition.End) {\r\n\t\t\t\t\ttarget.selectionStart = target.selectionEnd = start + line.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t\t// return { backoffset: 0 }\r\n\t}\r\n\r\n}","// @ts-nocheck\r\n\r\nimport { storeMultiactions, storeAction, undo } from \"./undoManager/initialize\";\r\nimport main from './undoManager/initialize';\r\nimport { actionsMacro, multiMacro, finalPosition, buffer } from \"./macro__actions\";\r\n\r\nvar editor = null,\r\n\tmultiActions = {},\r\n\tactions = {};\r\n\r\nexport default function initialize(target, keys, panel) {\r\n\r\n\tmain(editor = target || document.querySelector('textarea'));\r\n\tif (!(target instanceof HTMLTextAreaElement)) throw new Error('editor with hot keys needs textarea on the page');\r\n\r\n\teditor.addEventListener('keydown', preformat);\r\n\tif (keys instanceof Object) {\r\n\r\n\t\tif ('actions' in keys && keys.actions instanceof Object) {\r\n\t\t\tactions = keys.actions;\t\t\t\t\t// actions.__proto__ = actionsMacro;\t\t\t\r\n\t\t}\r\n\t\tif ('multiActions' in keys && keys.multiActions instanceof Object) {\r\n\t\t\tmultiActions = keys.multiActions;\t\t// multiActions.__proto__ = multiMacro;\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tif (panel instanceof HTMLElement) panel = [].slice.apply(panel.querySelectorAll(`.${panel.className}>*`));\r\n\tif (Array.isArray(panel)) {\r\n\t\tpanel.forEach(btn => btn.addEventListener('onclick', format_text));\r\n\t}\r\n\r\n\teditor.addEventListener('paste', e => {\r\n\t\t\r\n\t\t// if (!e.isTrusted) return;\t\t\r\n\t\te.isTrusted && (buffer.paste || (() => { }))(e, e.clipboardData.getData('text/plain'));\r\n\t});\r\n\r\n\teditor.addEventListener('select', e => {\r\n\t\t// console.log(e)\t\t\r\n\t\t// if (editor.selectionStart+1 < editor.selectionEnd){\r\n\t\t// \tif (editor.value[editor.selectionEnd-1] === ' ') editor.selectionEnd--;\r\n\t\t// }\r\n\t})\r\n}\r\n\r\ninitialize.actionsMacro = actionsMacro;\r\ninitialize.multiMacro = multiMacro;\r\ninitialize.finalPosition = finalPosition;\r\n\r\n/**\r\n * в отличие от format_text(e)  \r\n * - триггерится только на текстареа (через нажатие горячих клавиш)\r\n * - обрабатывает случаи для таб\r\n * @param {*} event \r\n */\r\nfunction preformat(event) {\r\n\r\n\t// console.log(event);\r\n\tif (event.ctrlKey) event.code != 'KeyZ' ? format_text(event) : undo(event);\r\n\telse if (event.key.toLowerCase() === 'tab') {\r\n\r\n\t\t// определим, выделен ли текст\r\n\t\tlet start = event.target.selectionStart;\r\n\t\tlet end = event.target.selectionEnd;\r\n\t\tif (end - start > 0) {\r\n\r\n\t\t\tlet line = event.target.value.substring(start - 1, end);\r\n\t\t\tlet len = line.split('\\n').length - 1;\r\n\t\t\tif (len === 0) format_text(event);\r\n\t\t\telse {\r\n\r\n\t\t\t\tstoreMultiactions(event, () => {\r\n\r\n\t\t\t\t\tlet startLine = event.target.value.substring(0, start - 1)\r\n\t\t\t\t\tline = !event.shiftKey ? line.replace(/\\n/g, '\\n\t') : line.replace(/\\n\t/g, '\\n');\r\n\t\t\t\t\tlet endLine = event.target.value.substring(end);\r\n\t\t\t\t\tevent.target.value = [startLine, line, endLine].join('');\r\n\r\n\t\t\t\t\tevent.target.selectionStart = start;\r\n\t\t\t\t\tevent.target.selectionEnd = end + len * (event.shiftKey ? -1 : 1);\r\n\r\n\t\t\t\t})\r\n\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t\telse format_text(event);\r\n\t}\r\n}\r\n\r\n/**\r\n * форматирует выделенный фрагмент или строку, в которой находится каретка в текущий момент, \r\n * в соответствии с заданными правилами (actions и multiActions соответственно)\r\n * @param {*} event \r\n * @param {*} fake - эмуляция нажатого символа (опционально) для событий, не передающих нажатие клавиш (e.key)\r\n */\r\nfunction format_text(event, fake) {\r\n\r\n\tlet caret = null || 0;\r\n\tfake = fake || event.target.getAttribute('data-key')\r\n\r\n\t// получаем позицию курсора\r\n\tif (editor.selectionStart !== undefined) {\r\n\t\tif (editor.selectionStart < editor.selectionEnd) {\r\n\t\t\tif (editor.value.slice(editor.selectionStart, editor.selectionEnd).split('\\n').length > 1) {\r\n\t\t\t\tevent.key = event.key || event.target.getAttribute('data-key');\r\n\t\t\t\tif (multiActions[event.key] || multiActions[event.code]) {\t\t\t\t\t\r\n\r\n\t\t\t\t\treturn storeMultiactions(event,\r\n\t\t\t\t\t\t() => (multiActions[event.key] || multiActions[event.code])(event), // o => editor.selectionStart = editor.selectionEnd-=o.backoffset\t\t\t\t\t\t\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (event.code === 'KeyV'){ // спец категория экшенов в мультиэкшене - это работа с буфером\r\n\r\n\t\t\t\tif (multiActions[event.key] || multiActions[event.code]) {\r\n\r\n\t\t\t\t\teditor.selectionEnd-=editor.value[editor.selectionEnd-1] === ' ';\r\n\t\t\t\t\tevent.target.dispatchEvent(new KeyboardEvent('keydown'));\r\n\t\t\t\t\t(multiActions[event.key] || multiActions[event.code])(event);\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// else if(middlelineActions[event.key](event)) // todo\t\t\t\t\r\n\t\t\t// замена посреди строки (для ссылок и курсивного текста, например)\t\t\t\r\n\t\t}\r\n\t\tcaret = editor.selectionStart;\r\n\t}\r\n\telse alert('The browser not supports hot keys');\t\t\t\t// polyfill is required\r\n\r\n\r\n\t// получаем позицию начала строки\r\n\tlet startLine = (editor.value.lastIndexOf('\\n', caret - 1));\r\n\tif (startLine < 0) startLine = 0;\r\n\r\n\r\n\t// получаем позицию конца строки\r\n\tlet endLine = (editor.value.indexOf('\\n', caret));\r\n\tif (endLine < 0) endLine = editor.value.length;\r\n\r\n\r\n\t// получаем текст:\r\n\tlet preLine = editor.value.substr(0, startLine ? startLine + 1 : startLine);\r\n\tlet line = editor.value.substring(startLine ? startLine + 1 : startLine, endLine);\r\n\tlet postLine = editor.value.substr(endLine);\r\n\r\n\t// actions.get(event && (event.key || (event.target.tagName.toLowerCase() === 'button' ? '/' : undefined)))\r\n\r\n\r\n\t// !todo undoMaager binding:\r\n\tvar formatAction = actions[event && (event.key || fake)];\r\n\tif (!event.key) event = { target: editor };\t\t\t\t\t\t // для кнопки нужно подменить target\r\n\tif (formatAction) {\r\n\r\n\t\tlet preformat = storeAction(event, () => {\r\n\t\t\tvar preformat = formatAction(line, event);\r\n\t\t\teditor.value = preLine + preformat.line + postLine;\r\n\t\t\treturn preformat;\r\n\t\t}, {\r\n\t\t\tstartLine: startLine, endLine: endLine\r\n\t\t})\r\n\r\n\t\tif (preformat.eventAbort) event.preventDefault();\r\n\t\t// возвращаем выделение\r\n\t\teditor.selectionStart = editor.selectionEnd = caret + preformat.offset * (preformat.undo ? -1 : 1);\r\n\r\n\t}\r\n\telse {\r\n\t\treturn;\r\n\t}\r\n\r\n\teditor.focus();\r\n\r\n}"],"names":["editor","document","getElementById","querySelector","undoStorage","redoStorage","addEventListener","event","input","selection","start","target","selectionStart","end","selectionEnd","selection_length","lostData","value","slice","e","data","window","clipboardData","getData","replace","console","log","inputType","preventDefault","type","InputActionType","insertFromPaste","deleteContentBackward","deleteContentForward","insertText","push","Object","assign","splice","length","this","actionApply","doingState","doingType","Boolean","substring","setSelectionRange","caret","storeMultiactions","callback","onfinish","dispatchEvent","KeyboardEvent","postOptions","transfer","DataTransfer","setData","clipboardEvent","ClipboardEvent","InputEvent","undefined","backoffset","storeAction","kwargs","startLine","endLine","preformat","substr","line","deleteByCut","undo","shiftKey","redoState","pop","undoState","buffer","paste","finalPosition","freeze","Begin","preBegin","fillInside","Fill","preEnd","End","multiMacro","begin","len","split","startsWith","format_text","RegExp","join","begin_end","startText","endText","paste_inline","position","condition","indexOf","_buff","multiActions","actions","initialize","keys","panel","HTMLTextAreaElement","Error","HTMLElement","apply","querySelectorAll","className","Array","isArray","forEach","btn","isTrusted","ctrlKey","code","key","toLowerCase","fake","getAttribute","alert","lastIndexOf","preLine","postLine","formatAction","eventAbort","offset","focus","actionsMacro","tag_in","res","regex","undoFlag","match","exec"],"mappings":"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"}