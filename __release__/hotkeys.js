var hokInit=function(){var s=document.getElementById("editor")||document.querySelector("textarea"),a=[],r=[];s.addEventListener("keydown",function(e){i.selection={start:e.target.selectionStart,end:e.target.selectionEnd},i.selection_length?i.lostData=s.value.slice(i.selection.start,i.selection.end):i.lostData=s.value.slice(i.selection.start-1,i.selection.end+1)}),s.addEventListener("paste",function(e){i.data=(window.clipboardData||e.clipboardData).getData("text/plain"),i.data=i.data.replace(/\r\n/g,"\n")}),s.addEventListener("input",function(e){return"historyUndo"==e.inputType?(console.log(e.inputType),e.preventDefault(),!1):(i.type=e.inputType,i.type!==o.insertFromPaste&&(i.data=e.data),i.selection_length?i.selection.end=i.selection.start:i.type==o.deleteContentBackward?(i.selection.start--,i.selection.end--,i.lostData=i.lostData[0]):i.type==o.deleteContentForward?i.lostData=i.lostData[1]:i.type!=o.insertText&&i.type!=o.insertFromPaste||(i.lostData=i.lostData.slice(1,-1)),a.push(Object.assign({},i)),void("historyUndo"!=e.inputType&&r.splice(0,r.length)))});var i={type:null,data:null,lostData:null,get selection_length(){return this.selection.end-this.selection.start},selection:{start:null,end:null}};function l(e,t){var n,a;switch(Boolean(t)!==Boolean("redo")?(a=e.lostData,n=e.data):(n=e.lostData,a=e.data),e.type){case"insertFromPaste":s.value=s.value.substring(0,e.selection.start)+a+s.value.substring(e.selection.start+n.length),s.setSelectionRange(e.selection.start,e.selection.end+a.length),e.caret&&(s.selectionStart=s.selectionEnd);break;case"insertText":e.selection_length||(s.value=s.value.substring(0,e.selection.start)+(a||"")+s.value.substring(e.selection.start+(n||"").length)),s.setSelectionRange(e.selection.start+a.length,e.selection.end+a.length);break;case"deleteByCut":case"deleteContentForward":case"deleteContentBackward":s.value=s.value.substring(0,e.selection.start)+(a||"")+s.value.substring(e.selection.end+!!t*(n||"").length),s.selectionStart=s.selectionEnd=e.selection.start+(e.type==o.deleteContentBackward&&1==(a||"").length),1<(a||"").length&&(s.selectionEnd=e.selection.start+a.length)}}var c=function(e,t,n){e.target.dispatchEvent(new KeyboardEvent("keydown"));var a=t(e),t=new DataTransfer;t.setData("text/plain",e.target.value.slice(e.target.selectionStart,e.target.selectionEnd));t=new ClipboardEvent("paste",{clipboardData:t});e.target.dispatchEvent(t),e.target.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),n&&a&&void 0!==a.backoffset&&n(a)},u=function(e,t,n){e.target.selectionStart=n.startLine+1,e.target.selectionEnd=n.endLine,e.target.dispatchEvent(new KeyboardEvent("keydown",{}));var a=t(e),t=new DataTransfer;t.setData("text/plain",e.target.value.substr(n.startLine+1,a.line.length));t=new ClipboardEvent("paste",{clipboardData:t});return e.target.dispatchEvent(t),i.caret=123,e.target.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),i.caret=void 0,a},o={insertFromPaste:"insertFromPaste",deleteByCut:"deleteByCut",insertText:"insertText",deleteContentBackward:"deleteContentBackward",deleteContentForward:"deleteContentForward"},e=function(e){if(e.shiftKey)return n=e,void((t=r.pop())&&(a.push(t),l(t,"redo"),n.preventDefault()));var t,n=a.pop();n&&(r.push(n),l(n,""),e.preventDefault())},d={paste:null},g=Object.freeze({Begin:0,preBegin:1,fillInside:2,Fill:3,preEnd:4,End:5}),t={begin:function(e,t,n){var a,s=n.selectionStart,r=n.selectionEnd,i=n.value.substring(s-1,r),l=(i.split("\n").length-1)*e.length,o=i.startsWith("\n"+e);0==l?format_text(t):(a=n.value.substring(0,s-1),i=o?i.replace(new RegExp("\n"+e,"g"),"\n"):i.replace(new RegExp("\n","g"),"\n"+e),n.value=[a,i,n.value.substring(r)].join(""),n.selectionStart=s,n.selectionEnd=r+l*(o?-1:1)),t.preventDefault()},begin_end:function(e,t,n){var a,s,r=n.selectionStart,i=n.selectionEnd,l=n.value.substring(r,i);return 1===l.split("\n").length?format_text(t):(a=n.value.substring(0,r),l=e[0]+n.value.substring(r,i)+e[1],s=n.value.substring(i),n.value=[a,l,s].join(""),n.setSelectionRange(r,i+e[0].length+e[1].length)),t.preventDefault(),{backoffset:void 0}},paste_inline:function(a,e,s,r,i){var l=s.selectionStart,o=s.selectionEnd,c=s.value.substring(l,o);0<c.indexOf("\n")||(d.paste=function(e,t){var n;i(t)&&(n=s.value.substring(0,l),c=a.replace("%1",c).replace("$1",t),t=s.value.substring(o),s.value=[n,c,t].join(""),s.selectionEnd=(s.selectionStart=l)+c.length,e.preventDefault(),d.paste=null,(t=new DataTransfer).setData("text/plain",c),e.target.dispatchEvent(new ClipboardEvent("paste",{clipboardData:t})),s.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),r===g.End&&(s.selectionStart=s.selectionEnd=l+c.length))})}},p=null,v={},f={};function n(e,t,n){var a;if(a=p=e||document.querySelector("textarea"),s=a,!(e instanceof HTMLTextAreaElement))throw new Error("editor with hot keys needs textarea on the page");p.addEventListener("keydown",h),t instanceof Object&&("actions"in t&&t.actions instanceof Object&&(f=t.actions),"multiActions"in t&&t.multiActions instanceof Object&&(v=t.multiActions)),n instanceof HTMLElement&&(n=[].slice.apply(n.querySelectorAll(".".concat(n.className,">*")))),Array.isArray(n)&&n.forEach(function(e){return e.addEventListener("click",y)}),p.addEventListener("paste",function(e){e.isTrusted&&(d.paste||function(){})(e,e.clipboardData.getData("text/plain"))}),p.addEventListener("select",function(e){})}function h(n){var a,s,r,i;n.ctrlKey?("KeyZ"!=n.code?y:e)(n):"tab"===n.key.toLowerCase()&&(a=n.target.selectionStart,0<(s=n.target.selectionEnd)-a?(r=n.target.value.substring(a-1,s),0==(i=r.split("\n").length-1)?y(n):c(n,function(){var e=n.target.value.substring(0,a-1);r=n.shiftKey?r.replace(/\n	/g,"\n"):r.replace(/\n/g,"\n\t");var t=n.target.value.substring(s);n.target.value=[e,r,t].join(""),n.target.selectionStart=a,n.target.selectionEnd=s+i*(n.shiftKey?-1:1)}),n.preventDefault()):y(n))}function y(t,e){var n=0;if(e=e||t.target.getAttribute("data-key"),void 0!==p.selectionStart){if(p.selectionStart<p.selectionEnd)if(1<p.value.slice(p.selectionStart,p.selectionEnd).split("\n").length){if(t.key=t.key||t.target.getAttribute("data-key"),v[t.key]||v[t.code])return c(t,function(){return(v[t.key]||v[t.code])(t)})}else"KeyV"===t.code&&(v[t.key]||v[t.code])&&(p.selectionEnd-=" "===p.value[p.selectionEnd-1],t.target.dispatchEvent(new KeyboardEvent("keydown")),(v[t.key]||v[t.code])(t));n=p.selectionStart}else alert("The browser not supports hot keys");var a=p.value.lastIndexOf("\n",n-1);a<0&&(a=0);var s=p.value.indexOf("\n",n);s<0&&(s=p.value.length);var r=p.value.substr(0,a&&a+1),i=p.value.substring(a&&a+1,s),l=p.value.substr(s),o=f[t&&(t.key||e)];t.key||(t={target:p}),o&&((s=u(t,function(){var e=o(i,t);return p.value=r+e.line+l,e},{startLine:a,endLine:s})).eventAbort&&t.preventDefault(),p.selectionStart=p.selectionEnd=n+s.offset*(s.undo?-1:1),p.focus())}return n.actionsMacro={tag_in:function(e,t){t=this.begin_end(["<"+e+">","</"+e+">"],t);return t.offset+=t.offset+1,t},begin_end:function(e,t){var n=e[0],a=e[1],s=new RegExp(n+"([\\s\\S]*?)"+a),e=t.match(s);return{line:e?t.replace(s,"$1"):n+t+a,offset:n.length,undo:e}},begin:function(e,t,n){var a=new RegExp("^"+e+"([\\s\\S]+?)$"),n=n?n.shiftKey:a.exec(t);return{line:n?t.replace(a,"$1"):e+t,offset:e.length,undo:n,eventAbort:!0}}},n.multiMacro=t,n.finalPosition=g,n}();
//# sourceMappingURL=hotkeys.js.map
