var hokInit=function(){var r=document.getElementById("editor")||document.querySelector("textarea"),a=[],s=[];r.addEventListener("keydown",function(e){l.selection={start:e.target.selectionStart,end:e.target.selectionEnd},l.selection_length?l.lostData=r.value.slice(l.selection.start,l.selection.end):l.lostData=r.value.slice(l.selection.start-1,l.selection.end+1)}),r.addEventListener("paste",function(e){l.data=(window.clipboardData||e.clipboardData).getData("text/plain"),l.data=l.data.replace(/\r\n/g,"\n")}),r.addEventListener("input",function(e){return console.log(e),"historyUndo"==e.inputType?(console.log(e.inputType),e.preventDefault(),!1):(l.type=e.inputType,l.type!==o.insertFromPaste&&(l.data=e.data),l.selection_length?l.selection.end=l.selection.start+((l.selection.data||{}).length||0):l.type==o.deleteContentBackward?(l.selection.start--,l.selection.end--,l.lostData=l.lostData[0]):l.type==o.deleteContentForward?l.lostData=l.lostData[1]:l.type!=o.insertText&&l.type!=o.insertFromPaste||(l.lostData=l.lostData.slice(1,-1)),a.push(Object.assign({},l)),void("historyUndo"!=e.inputType&&s.splice(0,s.length)))});var l={type:null,data:null,lostData:null,get selection_length(){return this.selection.end-this.selection.start},selection:{start:null,end:null}};function i(e,t){var n,a;switch(Boolean(t)!==Boolean("redo")?(a=e.lostData,n=e.data):(n=e.lostData,a=e.data),e.type){case"insertFromPaste":r.value=r.value.substring(0,e.selection.start)+a+r.value.substring(e.selection.start+n.length),r.setSelectionRange(e.selection.start,e.selection.end+a.length),e.caret&&(r.selectionStart=r.selectionEnd);break;case"insertText":e.selection_length||(r.value=r.value.substring(0,e.selection.start)+(a||"")+r.value.substring(e.selection.start+(n||"").length)),r.setSelectionRange(e.selection.start+a.length,e.selection.end+a.length);break;case"deleteByCut":case"deleteContentForward":case"deleteContentBackward":r.value=r.value.substring(0,e.selection.start)+(a||"")+r.value.substring(e.selection.end+!!t*(n||"").length),r.selectionStart=r.selectionEnd=e.selection.start+(e.type==o.deleteContentBackward&&1==(a||"").length),1<(a||"").length&&(r.selectionEnd=e.selection.start+a.length)}}var c=function(e,t,n){e.target.dispatchEvent(new KeyboardEvent("keydown"));var a=t(e),t=new DataTransfer;t.setData("text/plain",e.target.value.slice(e.target.selectionStart,e.target.selectionEnd));t=new ClipboardEvent("paste",{clipboardData:t});e.target.dispatchEvent(t),e.target.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),n&&n(a)},u=function(e,t,n){e.target.selectionStart=n.startLine+1,e.target.selectionEnd=n.endLine,e.target.dispatchEvent(new KeyboardEvent("keydown",{}));var a=t(e),t=new DataTransfer;t.setData("text/plain",e.target.value.substr(n.startLine+1,a.line.length));t=new ClipboardEvent("paste",{clipboardData:t});return e.target.dispatchEvent(t),l.caret=123,e.target.dispatchEvent(new InputEvent("input",{data:null,inputType:"insertFromPaste"})),l.caret=void 0,a},o={insertFromPaste:"insertFromPaste",deleteByCut:"deleteByCut",insertText:"insertText",deleteContentBackward:"deleteContentBackward",deleteContentForward:"deleteContentForward"},e=function(e){if(e.shiftKey)return n=e,void((t=s.pop())&&(a.push(t),i(t,"redo"),n.preventDefault()));var t,n=a.pop();n&&(s.push(n),i(n,""),e.preventDefault())},t={begin:function(e,t,n){var a,r=n.selectionStart,s=n.selectionEnd,l=n.value.substring(r-1,s),i=(l.split("\n").length-1)*e.length,o=l.startsWith("\n"+e);0==i?format_text(t):(a=n.value.substring(0,r-1),l=o?l.replace(new RegExp("\n"+e,"g"),"\n"):l.replace(new RegExp("\n","g"),"\n"+e),n.value=[a,l,n.value.substring(s)].join(""),n.selectionStart=r,n.selectionEnd=s+i*(o?-1:1)),t.preventDefault()},begin_end:function(e,t,n){var a,r,s=n.selectionStart,l=n.selectionEnd,i=n.value.substring(s,l);return 1===i.split("\n").length?format_text(t):(a=n.value.substring(0,s),i=e[0]+n.value.substring(s,l)+e[1],r=n.value.substring(l),n.value=[a,i,r].join(""),n.setSelectionRange(s,l+e[0].length+e[1].length)),t.preventDefault(),{backoffset:e[1].length}}},d=null,g={},v={};function n(e,t,n){var a;if(a=d=e||document.querySelector("textarea"),r=a,!(e instanceof HTMLTextAreaElement))throw new Error("editor with hot keys needs textarea on the page");d.addEventListener("keydown",p),t instanceof Object&&("actions"in t&&t.actions instanceof Object&&(v=t.actions),"multiActions"in t&&t.multiActions instanceof Object&&(g=t.multiActions)),n instanceof HTMLElement&&(n=[].slice.apply(n.querySelectorAll(".".concat(n.className,">*")))),Array.isArray(n)&&n.forEach(function(e){return e.addEventListener("onclick",f)})}function p(n){var a,r,s,l;n.ctrlKey?("KeyZ"!=n.code?f:e)(n):"tab"===n.key.toLowerCase()&&(a=n.target.selectionStart,0<(r=n.target.selectionEnd)-a?(s=n.target.value.substring(a-1,r),0==(l=s.split("\n").length-1)?f(n):c(n,function(){var e=n.target.value.substring(0,a-1);s=n.shiftKey?s.replace(/\n	/g,"\n"):s.replace(/\n/g,"\n\t");var t=n.target.value.substring(r);n.target.value=[e,s,t].join(""),n.target.selectionStart=a,n.target.selectionEnd=r+l*(n.shiftKey?-1:1)}),n.preventDefault()):f(n))}function f(t,e){var n=0;if(e=e||t.target.getAttribute("data-key"),void 0!==d.selectionStart){if(d.selectionStart<d.selectionEnd&&1<d.value.slice(d.selectionStart,d.selectionEnd).split("\n").length&&(t.key=t.key||t.target.getAttribute("data-key"),g[t.key]))return t.target.dispatchEvent(new KeyboardEvent("keydown")),void c(t,function(){return g[t.key](t)});n=d.selectionStart}else alert("The browser not supports hot keys");var a=d.value.lastIndexOf("\n",n-1);a<0&&(a=0);var r=d.value.indexOf("\n",n);r<0&&(r=d.value.length);var s=d.value.substr(0,a&&a+1),l=d.value.substring(a&&a+1,r),i=d.value.substr(r),o=v[t&&(t.key||e)];t.key||(t={target:d}),o&&((r=u(t,function(){var e=o(l,t);return d.value=s+e.line+i,e},{startLine:a,endLine:r})).eventAbort&&t.preventDefault(),d.selectionStart=d.selectionEnd=n+r.offset*(r.undo?-1:1),d.focus())}return n.actionsMacro={tag_in:function(e,t){t=this.begin_end(["<"+e+">","</"+e+">"],t);return t.offset+=t.offset+1,t},begin_end:function(e,t){var n=e[0],a=e[1],r=new RegExp(n+"([\\s\\S]*?)"+a),e=t.match(r);return{line:e?t.replace(r,"$1"):n+t+a,offset:n.length,undo:e}},begin:function(e,t,n){var a=new RegExp("^"+e+"([\\s\\S]+?)$"),n=n?n.shiftKey:a.exec(t);return{line:n?t.replace(a,"$1"):e+t,offset:e.length,undo:n,eventAbort:!0}}},n.multiMacro=t,n}();
//# sourceMappingURL=hotkeys.js.map
